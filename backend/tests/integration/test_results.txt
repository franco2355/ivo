=== RUN   TestActivityCapacityLimit
    activity_capacity_test.go:16: ğŸš€ Iniciando test de integraciÃ³n: Activity Capacity Limit
    activity_capacity_test.go:19: 
        ğŸ“ PASO 1: Login de mÃºltiples usuarios y admin
    activity_capacity_test.go:22: âœ… Admin logueado - ID: 1
    activity_capacity_test.go:26: âœ… Usuario 1 logueado - ID: 5
    activity_capacity_test.go:33: 
        ğŸ“ PASO 2: Crear actividad con cupo limitado (3 personas)
    activity_capacity_test.go:82: âœ… Actividad creada con ID: 89, Cupo: 3
    activity_capacity_test.go:85: 
        ğŸ“ PASO 3: Activar suscripciÃ³n Premium para usuario
    helpers.go:241: âŒ Error creando suscripciÃ³n - Status: 400, Body: {"error":"ya tienes una suscripciÃ³n activa. No puedes crear otra hasta que expire o sea cancelada"}
--- FAIL: TestActivityCapacityLimit (0.08s)
=== RUN   TestConcurrentInscriptions
    activity_capacity_test.go:243: ğŸš€ Iniciando test de integraciÃ³n: Concurrent Inscriptions
    activity_capacity_test.go:247: âœ… Admin logueado - ID: 1
    activity_capacity_test.go:250: âœ… Usuario logueado - ID: 5
    helpers.go:241: âŒ Error creando suscripciÃ³n - Status: 400, Body: {"error":"ya tienes una suscripciÃ³n activa. No puedes crear otra hasta que expire o sea cancelada"}
--- FAIL: TestConcurrentInscriptions (0.02s)
=== RUN   TestCashPaymentFlowWithPlanRestrictions
    cash_payment_and_restrictions_test.go:33: ğŸš€ Iniciando test de integraciÃ³n completo: Cash Payment + Plan Restrictions
    cash_payment_and_restrictions_test.go:38: 
        ğŸ“ PASO 1: Registrar nuevo usuario con datos vÃ¡lidos
    helpers.go:136: âœ… Usuario registrado - Username: user_717861, ID: 23
    cash_payment_and_restrictions_test.go:40: âœ… Usuario registrado y logueado - Username: user_717861, ID: 23
    cash_payment_and_restrictions_test.go:45: 
        ğŸ“ PASO 2: Login como admin
    cash_payment_and_restrictions_test.go:47: âœ… Admin logueado - ID: 1, Token: Bearer eyJhbGciOiJIU...
    cash_payment_and_restrictions_test.go:52: 
        ğŸ“ PASO 3: Crear suscripciÃ³n con Plan BÃ¡sico (limitado a yoga y spinning)
    cash_payment_and_restrictions_test.go:54: âœ… SuscripciÃ³n creada - ID: 69289f351d79fc74417ef75f
    cash_payment_and_restrictions_test.go:61: âœ… SuscripciÃ³n en estado: pendiente_pago
    cash_payment_and_restrictions_test.go:66: 
        ğŸ“ PASO 4: Crear pago en efectivo
    cash_payment_and_restrictions_test.go:68: âœ… Pago en efectivo creado - ID: 69289f35c18923d549b1d223
    cash_payment_and_restrictions_test.go:78: âœ… Pago en estado: pending, Gateway: cash
    cash_payment_and_restrictions_test.go:83: 
        ğŸ“ PASO 5: Admin aprueba el pago en efectivo
    cash_payment_and_restrictions_test.go:85: âœ… Pago aprobado por admin
    cash_payment_and_restrictions_test.go:92: âœ… Pago actualizado a estado: completed
    cash_payment_and_restrictions_test.go:97: 
        ğŸ“ PASO 6: Activando suscripciÃ³n...
    cash_payment_and_restrictions_test.go:108: âœ… SuscripciÃ³n activada! Estado: activa, PagoID: 69289f35c18923d549b1d223
    cash_payment_and_restrictions_test.go:113: 
        ğŸ“ PASO 7: Verificar suscripciÃ³n activa desde endpoint /active
    cash_payment_and_restrictions_test.go:118: âœ… SuscripciÃ³n activa verificada - Plan: Plan BÃ¡sico
    cash_payment_and_restrictions_test.go:123: 
        ğŸ“ PASO 8: Intentar inscribirse a Funcional (NO permitida por Plan BÃ¡sico)
    cash_payment_and_restrictions_test.go:128: âœ… InscripciÃ³n bloqueada correctamente! Error: La actividad no existe
    cash_payment_and_restrictions_test.go:132: âš ï¸  Mensaje de error diferente al esperado: La actividad no existe
    cash_payment_and_restrictions_test.go:138: 
        ğŸ“ PASO 9: Limpiar inscripciones previas a Yoga si existen
    cash_payment_and_restrictions_test.go:152: 
        ğŸ“ PASO 10: Inscribirse a Yoga (permitida por Plan BÃ¡sico)
    cash_payment_and_restrictions_test.go:163: âœ… InscripciÃ³n exitosa a Yoga! UsuarioID: 23, ActividadID: 1
    cash_payment_and_restrictions_test.go:168: 
        ğŸ“ PASO 11: Verificar lista de inscripciones del usuario
    cash_payment_and_restrictions_test.go:180: âœ… InscripciÃ³n a Yoga encontrada en la lista (Total inscripciones: 1)
    cash_payment_and_restrictions_test.go:186: 
        ================================================================================
    cash_payment_and_restrictions_test.go:187: ğŸ‰ TEST COMPLETADO EXITOSAMENTE!
    cash_payment_and_restrictions_test.go:188: ================================================================================
    cash_payment_and_restrictions_test.go:189: âœ… Login de usuario y admin
    cash_payment_and_restrictions_test.go:190: âœ… CreaciÃ³n de suscripciÃ³n con Plan BÃ¡sico (limitado)
    cash_payment_and_restrictions_test.go:191: âœ… CreaciÃ³n de pago en efectivo
    cash_payment_and_restrictions_test.go:192: âœ… AprobaciÃ³n de pago por admin
    cash_payment_and_restrictions_test.go:193: âœ… ActivaciÃ³n automÃ¡tica de suscripciÃ³n via RabbitMQ
    cash_payment_and_restrictions_test.go:194: âœ… Bloqueo de inscripciÃ³n a actividad NO permitida
    cash_payment_and_restrictions_test.go:195: âœ… InscripciÃ³n exitosa a actividad permitida
    cash_payment_and_restrictions_test.go:196: ================================================================================
--- PASS: TestCashPaymentFlowWithPlanRestrictions (0.16s)
=== RUN   TestJWTSecurityValidation
    jwt_security_test.go:13: ğŸš€ Iniciando test de integraciÃ³n: JWT Security Validation
    jwt_security_test.go:18: 
        ğŸ“ PASO 1: Registrar nuevo usuario
    helpers.go:136: âœ… Usuario registrado - Username: user_777398, ID: 24
    jwt_security_test.go:20: âœ… Usuario registrado - Username: user_777398, ID: 24
    jwt_security_test.go:23: âœ… Admin logueado - ID: 1
    jwt_security_test.go:26: 
        ğŸ“ PASO 2: Intentar acceder a actividades SIN token (debe retornar 401)
    jwt_security_test.go:37: âœ… Correctamente bloqueado sin token - Status: 401
    jwt_security_test.go:44: 
        ğŸ“ PASO 3: Intentar con token INVÃLIDO (debe retornar 401)
    jwt_security_test.go:55: âœ… Correctamente bloqueado con token invÃ¡lido - Status: 401
    jwt_security_test.go:62: 
        ğŸ“ PASO 4: Crear suscripciÃ³n con token vÃ¡lido
    jwt_security_test.go:65: âœ… SuscripciÃ³n creada - ID: 69289f361d79fc74417ef760
    jwt_security_test.go:70: âœ… Usuario puede acceder a su propia suscripciÃ³n con token vÃ¡lido
    jwt_security_test.go:74: 
        ğŸ“ PASO 5: Usuario normal intenta crear actividad (requiere admin)
    jwt_security_test.go:101: âœ… Correctamente bloqueado usuario sin permisos de admin - Status: 403
    jwt_security_test.go:109: 
        ğŸ“ PASO 6: Admin crea actividad (debe funcionar)
    jwt_security_test.go:127: âœ… Admin creÃ³ actividad exitosamente - Respuesta: map[categoria:yoga cupo:10 descripcion:Intento de creaciÃ³n sin permisos dia:Lunes foto_url:https://images.unsplash.com/photo-1544367567-0f2fcb009e0b horario_final:11:00 horario_inicio:10:00 id:90 instructor:Test Instructor lugares:0 sucursal_id:1 titulo:Actividad No Autorizada]
    jwt_security_test.go:136: 
        ğŸ“ PASO 7: Usuario normal intenta aprobar pago (requiere admin)
    jwt_security_test.go:168: âœ… Pago creado - ID: 69289f36c18923d549b1d224
    jwt_security_test.go:189: âš ï¸  ADVERTENCIA: Usuario normal pudo aprobar pago (deberÃ­a requerir admin)
    jwt_security_test.go:195: 
        ğŸ“ PASO 8: Acceder a /inscripciones sin token
    jwt_security_test.go:207: âœ… Correctamente bloqueado acceso sin token - Status: 401
    jwt_security_test.go:215: 
        ================================================================================
    jwt_security_test.go:216: ğŸ‰ TEST DE VALIDACIÃ“N DE JWT Y SEGURIDAD COMPLETADO!
    jwt_security_test.go:217: ================================================================================
    jwt_security_test.go:218: âœ… Login vÃ¡lido funciona correctamente
    jwt_security_test.go:219: âœ… Requests sin token son bloqueados
    jwt_security_test.go:220: âœ… Tokens invÃ¡lidos son rechazados
    jwt_security_test.go:221: âœ… Usuarios pueden acceder a sus propios recursos
    jwt_security_test.go:222: âœ… Endpoints de admin estÃ¡n protegidos
    jwt_security_test.go:223: âœ… SeparaciÃ³n de permisos funcionando
    jwt_security_test.go:224: ================================================================================
--- PASS: TestJWTSecurityValidation (0.08s)
=== RUN   TestPaymentCreationFlow
    payment_workflow_test.go:14: ğŸš€ Iniciando test de flujo de pagos
    payment_workflow_test.go:17: 
        ğŸ“ Paso 1: Registrar usuario y obtener admin token
    helpers.go:136: âœ… Usuario registrado - Username: user_910047, ID: 25
    payment_workflow_test.go:19: âœ… Usuario registrado - ID: 25
    payment_workflow_test.go:22: âœ… Admin logueado
=== RUN   TestPaymentCreationFlow/Create_cash_payment_for_subscription
    payment_workflow_test.go:27: âœ… SuscripciÃ³n creada - ID: 69289f361d79fc74417ef761
=== RUN   TestPaymentCreationFlow/Create_cash_payment_for_subscription/Update_payment_status_to_completed
    payment_workflow_test.go:99: Expected status 200, got: 404
=== RUN   TestPaymentCreationFlow/Create_cash_payment_for_subscription/Get_payment_by_ID
=== RUN   TestPaymentCreationFlow/Create_payment_with_invalid_data
--- FAIL: TestPaymentCreationFlow (0.06s)
    --- FAIL: TestPaymentCreationFlow/Create_cash_payment_for_subscription (0.03s)
        --- FAIL: TestPaymentCreationFlow/Create_cash_payment_for_subscription/Update_payment_status_to_completed (0.01s)
        --- PASS: TestPaymentCreationFlow/Create_cash_payment_for_subscription/Get_payment_by_ID (0.01s)
    --- PASS: TestPaymentCreationFlow/Create_payment_with_invalid_data (0.00s)
=== RUN   TestPaymentListingAndFiltering
    payment_workflow_test.go:374: Failed to get admin token
--- FAIL: TestPaymentListingAndFiltering (0.00s)
=== RUN   TestPaymentAuthorizationRules
--- FAIL: TestPaymentAuthorizationRules (0.00s)
panic: interface conversion: interface {} is nil, not string [recovered]
	panic: interface conversion: interface {} is nil, not string

goroutine 106 [running]:
testing.tRunner.func1.2({0x1264a60, 0xc0001fc780})
	C:/Program Files/Go/src/testing/testing.go:1734 +0x219
testing.tRunner.func1()
	C:/Program Files/Go/src/testing/testing.go:1737 +0x359
panic({0x1264a60?, 0xc0001fc780?})
	C:/Program Files/Go/src/runtime/panic.go:792 +0x132
github.com/yourusername/gym-management/tests/integration.TestPaymentAuthorizationRules(0xc000346540)
	C:/Users/eli_v/ivo/backend/tests/integration/payment_workflow_test.go:289 +0x6b0
testing.tRunner(0xc000346540, 0x12e7d50)
	C:/Program Files/Go/src/testing/testing.go:1792 +0xcb
created by testing.(*T).Run in goroutine 1
	C:/Program Files/Go/src/testing/testing.go:1851 +0x3f6
exit status 2
FAIL	github.com/yourusername/gym-management/tests/integration	2.344s
